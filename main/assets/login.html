<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

    <title>登录</title>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <script src="./static/js/jquery.min.js"></script>
    <script src="./static/js/jquery.cookie-1.4.1.min.js"></script>
    <script language=javascript src="./static/js/config.min.js"></script>
    <script src="./static/js/index.js"></script>
    <link rel="stylesheet" href="./static/css/login.css">
    <style>
        .sms {
            display: flex;
            justify-content: center;
            /* 子元素水平居中 */
            align-items: center;
            /* 子元素垂直居中 */
            margin-left: auto;
        }

        .sms label {
            margin: 0;
            height: 20px;
            width: 120px;
            font-size: 14px;
            color: #fff;

        }

        .sms #if_smsLogin {
            width: 24px;
            margin: 0;
        }

        #getSmsCode {
            margin: 0;
            background: none;
            height: auto;
            width: auto;
            color: #fff;
            padding: 0;
            position: absolute;
            top: 260px;
            right: 50px;
            border: none;
            outline: none;
        }

        #getSmsCode:hover {
            background: none;
            color: rgba(246, 246, 246, 0.726);
        }
    </style>
    <script>
        $(document).ready(function () {
            $("#getSmsCode").click(() => {
                let mobile = $("#mobile").val()
                let closeMsg;
                $('#getSmsCode').text() == "获取验证码" && (
                    closeMsg = Dreamer.loading("获取验证码中"),
                    mobile.length == 0 ? (Dreamer.error("手机号码不能为空", 2000), closeMsg()) : sendNote(mobile, 1, (status, data) => {
                        closeMsg();
                        switch (status) {
                            case "success":
                                if (data.code == 200) {
                                    Dreamer.success(data.msg, 2000, true)
                                    let time = 60;
                                    const s = setInterval(() => {
                                        if (time == 1) {
                                            $("#getSmsCode").text("获取验证码")
                                            $('#getSmsCode').css('color', '#fff');
                                            clearInterval(s);
                                            return;
                                        };
                                        time--;
                                        $("#getSmsCode").text(`剩余${time}秒`);
                                        $("#getSmsCode").css("color", "#5b5b5b");
                                    }, 1000)

                                } else { Dreamer.error(data.msg, 2000, true); }
                                break;
                            case "timeout":
                                Dreamer.error("请求超时了。" + status, 2000, true);
                                break;
                            default:
                                Dreamer.error("获取验证码失败", 2000, true);
                                break;
                        };
                    })
                )
            });
            $("#if_smsLogin").click(() => {
                let if_smslogin = $('#if_smsLogin').is(":checked");
                let input_pwd = $('#password');
                let getSmsCode = $('#getSmsCode');
                if (if_smslogin) {
                    input_pwd.attr("type", "text");
                    input_pwd.val("");
                    input_pwd.attr("placeholder", "验证码");
                    getSmsCode.attr("style", "display: flex;")

                } else {
                    input_pwd.attr("type", "password");
                    input_pwd.val($("#password").val(password));
                    getSmsCode.attr("style", "display: none;")
                    input_pwd.attr("placeholder", "密码");
                }
            });
            $('#btn_reset').click(function () {
                let password = $('#reset_passwd').val();
                let psswd = $("#reset_pwd").val();
                let verifyCode = $('#re_code').val();
                let mobile = $('#re_mobile').val();
                if (mobile.length == 0) {
                    Dreamer.warning("手机号不能为空哦！");
                } else if (password.length == 0) {
                    Dreamer.warning("密码不能为空哦！");
                } else if (verifyCode.length == 0) {
                    Dreamer.warning("验证码不能为空哦！");
                } else if (psswd != password) {
                    Dreamer.warning("两次密码不一致！");
                } else {
                    cloneMsg = Dreamer.loading("重置密码中……");
                    retrieve(
                        mobile = mobile,
                        password = password,
                        pass = psswd,
                        code = verifyCode,
                        _type = 2,
                        success = function (code, msg, result) {
                            if (code == 200) {
                                Dreamer.success(msg);
                            } else {
                                Dreamer.error(msg);
                            }
                            cloneMsg();
                        }
                    );
                }
            });
            $('#sendCode').click(function () {
                let mobile = $("#re_mobile").val()
                let closeMsg;
                $('#sendCode').text() == "获取验证码" && (
                    closeMsg = Dreamer.loading("获取验证码中"),
                    mobile.length == 0 ? (Dreamer.error("手机号码不能为空", 2000), closeMsg()) : sendNote(mobile, 2, (status, data) => {
                        closeMsg();
                        switch (status) {
                            case "success":
                                if (data.code == 200) {
                                    Dreamer.success(data.msg, 2000, true)
                                    let time = 60;
                                    const s = setInterval(() => {
                                        if (time == 1) {
                                            $("#sendCode").text("获取验证码")
                                            $('#sendCode').css('color', '#5892d4');
                                            clearInterval(s);
                                            return;
                                        };
                                        time--;
                                        $("#sendCode").text(`剩余${time}秒`);
                                        $("#sendCode").css("color", "#5b5b5b");
                                    }, 1000)

                                } else { Dreamer.error(data.msg, 2000, true); }
                                break;
                            case "timeout":
                                Dreamer.error("请求超时了。" + status, 2000, true);
                                break;
                            default:
                                Dreamer.error("获取验证码失败", 2000, true);
                                break;
                        };
                    })
                )
            });

            $('#btnLogin').click(function () {
                cloneMsg = Dreamer.loading("登录中.....");
                let if_smslogin = $('#if_smsLogin').is(":checked");
                if_smslogin == true ? smsLogin(mobile = $("#mobile").val(), code = ("#sendCode").val(), success = (status, data) => { cloneMsg(); status == "success" && data.code == 200 ? Dreamer.success("登录成功", true, 2000, function () { window.location.href = "./index.html"; }) : Dreamer.error("登录失败 " + data.msg, true, 2000) }) : login(mobile = $("#mobile").val(), password = $("#password").val(), success = (status, data) => { cloneMsg(); status == "success" && data.code == 200 ? Dreamer.success("登录成功", true, 2000, function () { window.location.href = "./index.html"; }) : Dreamer.error("登录失败 " + data.msg, true, 2000) })
            });
        });
    </script>
</head>

<body>
    <div class="container">
        <div class="form-box">
            <!-- 注册 -->
            <div class="register-box hidden">
                <h1>找回密码</h1>
                <input type="text" placeholder="手机号" id="re_mobile">
                <div style="display: flex;">
                    <input type="text" placeholder="验证码" id="re_code">
                    <button id="sendCode">获取验证码</button>
                </div>
                <input type="password" placeholder="密码" id="reset_passwd">
                <input type="password" placeholder="确认密码" id="reset_pwd">
                <button id="btn_reset">重置密码</button>
            </div>
            <!-- 登录 -->
            <div class="login-box">
                <h1>LOGIN</h1>
                <input type="text" placeholder="手机号" id="mobile">
                <input type="password" placeholder="密码" id="password">
                <button id="getSmsCode" style="display: none;">获取验证码</button>
                <span class="sms"><input type="checkbox" id="if_smsLogin"> <label for="if_smsLogin">验证码登录</label></span>
                <button id="btnLogin">登录</button>
            </div>
        </div>
        <div class="con-box left">
            <h2><span>糕点</span></h2>
            <!-- <p>快来领取你的专属<span>宠物</span>吧</p> -->
            <img src="./static/svg/logo.svg">
            <p>已有账号</p>
            <button id="login">去登录</button>
        </div>
        <div class="con-box right">
            <h2><span>糕点</span></h2>
            <!-- <p>快来看看你的可爱<span>宠物</span>吧</p> -->
            <img src="./static/svg/logo.svg">
            <p>忘记密码？</p>
            <button id="repassword">找回密码</button>
        </div>
    </div>
    <script>
        let username = $.cookie('username');
        let password = $.cookie('password');
        $("#mobile").val(username);
        $("#password").val(password);
    </script>
    <script>
        // 要操作到的元素
        let _login = document.getElementById('login');
        let repassword = document.getElementById('repassword');
        let form_box = document.getElementsByClassName('form-box')[0];
        let register_box = document.getElementsByClassName('register-box')[0];
        let login_box = document.getElementsByClassName('login-box')[0];
        // 去注册按钮点击事件
        repassword.addEventListener('click', () => {
            form_box.style.transform = 'translateX(80%)';
            login_box.classList.add('hidden');
            register_box.classList.remove('hidden');
        })
        // 去登录按钮点击事件
        _login.addEventListener('click', () => {
            form_box.style.transform = 'translateX(0%)';
            register_box.classList.add('hidden');
            login_box.classList.remove('hidden');
        })
    </script>
</body>

</html>