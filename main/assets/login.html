<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

    <title>登录</title>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <script src="./static/js/jquery.min.js"></script>
    <script src="./static/js/jquery.cookie-1.4.1.min.js"></script>
    <script language=javascript src="./static/js/config.min.js"></script>
    <script src="./static/js/index.js"></script>
    <link rel="stylesheet" href="./static/css/login.css">
    <script>
        $(document).ready(function () {
            $('#btn_reset').click(function () {
                let password = $('#reset_passwd').val();
                let psswd = $("#reset_pwd").val();
                let verifyCode = $('#re_code').val();
                let mobile = $('#re_mobile').val();
                if (mobile.length == 0) {
                    Dreamer.warning("手机号不能为空哦！");
                } else if (password.length == 0) {
                    Dreamer.warning("密码不能为空哦！");
                } else if (verifyCode.length == 0) {
                    Dreamer.warning("验证码不能为空哦！");
                } else if (psswd != password) {
                    Dreamer.warning("两次密码不一致！");
                } else {
                    cloneMsg = Dreamer.loading("重置密码中……");
                    retrieve(
                        mobile = mobile,
                        password = password,
                        pass = psswd,
                        code = verifyCode,
                        _type = 2,
                        success = function(code, msg, result) {
                            if (code == 200) {
                                Dreamer.success(msg);
                            } else {
                                Dreamer.error(msg);
                            }
                            cloneMsg();
                        }
                    );
                }
            });
            $('#sendCode').click(function () {
                if ($('#sendCode').text() == "获取验证码") {
                    let mobile = $("#re_mobile").val();
                    if (mobile.length <= 0) {
                        Dreamer.warning("手机号不能为空！");
                        return;
                    };
                    sendNote(
                        mobile = mobile,
                        _type = 2,
                        success = function (code, msg) {
                            if (code == 200) {
                                Dreamer.success(msg, true, 2000);
                                let time = 60;
                                let s = setInterval(function () {
                                    if (time == 1) {
                                        $('#sendCode').text('获取验证码');
                                        $('#sendCode').css('color', '#5892d4');
                                        clearInterval(s);
                                        return;
                                    };
                                    time--;
                                    $("#sendCode").text(`剩余${time}秒`)
                                    $("#sendCode").css("color", "#5b5b5b")
                                }, 1000);
                            } else {
                                Dreamer.error(msg, true, 2000);
                            };
                        }
                    );
                }
            });

            $('#btnLogin').click(function () {
                let if_smslogin = $('#if_smsLogin').is(":checked");
                if (if_smslogin) {
                    smsLogin(
                        $("#mobile").val(),
                        $("#sendCode").val(),
                        function (code, msg) {
                            if (code == 200) {
                                Dreamer.success(msg, true, 2000, function () {
                                    // console.log(msg);
                                    window.location.href = "./index.html";
                                });
                            } else {
                                Dreamer.error(msg, true, 2000, function () {
                                    console.log(msg);
                                });
                            }
                        }
                    );
                } else {
                    login(
                        $("#mobile").val(),
                        $("#password").val(),
                        function (code, msg) {
                            if (code == 200) {
                                Dreamer.success(msg, 2000, function () {
                                    // console.log(msg);
                                    window.location.href = "./index.html";
                                });
                            } else {
                                Dreamer.error(msg, true, 2000, function () {
                                    console.log(msg);
                                });
                            }
                        }
                    );
                };
            });
        });
    </script>
</head>

<body>
    <div class="container">
        <div class="form-box">
            <!-- 注册 -->
            <div class="register-box hidden">
                <h1>找回密码</h1>
                <input type="text" placeholder="手机号" id="re_mobile">
                <div style="display: flex;">
                    <input type="text" placeholder="验证码" id="re_code">
                    <button id="sendCode">获取验证码</button>
                </div>
                <input type="password" placeholder="密码" id="reset_passwd">
                <input type="password" placeholder="确认密码" id="reset_pwd">
                <button id="btn_reset">重置密码</button>
            </div>
            <!-- 登录 -->
            <div class="login-box">
                <h1>LOGIN</h1>
                <input type="text" placeholder="手机号" id="mobile">
                <input type="password" placeholder="密码" id="password">
                <input type="checkbox" id="if_smsLogin" style="display: none;">
                <button id="btnLogin">登录</button>
            </div>
        </div>
        <div class="con-box left">
            <h2><span>糕点</span></h2>
            <!-- <p>快来领取你的专属<span>宠物</span>吧</p> -->
            <img src="./static/svg/logo.svg">
            <p>已有账号</p>
            <button id="login">去登录</button>
        </div>
        <div class="con-box right">
            <h2><span>糕点</span></h2>
            <!-- <p>快来看看你的可爱<span>宠物</span>吧</p> -->
            <img src="./static/svg/logo.svg">
            <p>忘记密码？</p>
            <button id="repassword">找回密码</button>
        </div>
    </div>
    <script>
        let username = $.cookie('username');
        let password = $.cookie('password');
        $("#mobile").val(username);
        $("#password").val(password);
    </script>
    <script>
        // 要操作到的元素
        let _login = document.getElementById('login');
        let repassword = document.getElementById('repassword');
        let form_box = document.getElementsByClassName('form-box')[0];
        let register_box = document.getElementsByClassName('register-box')[0];
        let login_box = document.getElementsByClassName('login-box')[0];
        // 去注册按钮点击事件
        repassword.addEventListener('click', () => {
            form_box.style.transform = 'translateX(80%)';
            login_box.classList.add('hidden');
            register_box.classList.remove('hidden');
        })
        // 去登录按钮点击事件
        _login.addEventListener('click', () => {
            form_box.style.transform = 'translateX(0%)';
            register_box.classList.add('hidden');
            login_box.classList.remove('hidden');
        })
    </script>
</body>

</html>